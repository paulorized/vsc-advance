<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>VSC Advance Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --gap: 10px; --pad: 14px; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 18px; line-height: 1.4; }
    h1 { margin: 0 0 6px; }
    h2 { margin: 18px 0 8px; }
    .section { border: 1px solid #eee; border-radius: 12px; padding: var(--pad); margin-bottom: 14px; }
    .row { display: grid; grid-template-columns: 280px 1fr 130px; align-items: center; gap: var(--gap); margin: 8px 0; }
    .row label { font-weight: 600; }
    input[type=range] { width: 100%; }
    input[type=number], input[readonly], input[type=text] { width: 120px; padding: 8px; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: 8px 12px; border: 0; border-radius: 10px; background: #111; color: #fff; cursor: pointer; font-weight: 700; }
    button:active { transform: translateY(1px); }
    .muted { color: #666; font-size: 12px; margin-top: -4px; }
    .two { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    .outputs p { margin: 6px 0; }
    .hr { height: 1px; background: #eee; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
    th { background: #f8f8f8; text-align: center; }
    td:first-child, th:first-child { text-align: center; }

    /* Footer watermark */
    .powered {
      position: fixed;
      right: 14px;
      bottom: 10px;
      font-size: 12px;
      color: #bbb;
      user-select: none;
      pointer-events: none;
    }

    /* Print styles */
    @media print {
      .no-print { display: none !important; }
      body { margin: 0.5in; }
      .section { break-inside: avoid; }
      .powered { color: #ddd; }
    }
  </style>
</head>
<body>

  <div class="no-print" style="display:flex;gap:10px;align-items:center;margin-bottom:10px;">
    <button onclick="window.print()">Export to PDF</button>
    <span class="muted">Tip: The button opens your browser’s print dialog. Choose “Save as PDF”.</span>
  </div>

  <h1>VSC Advance Calculator</h1>
  <p class="muted">VSC (New/Used) only. Type numbers or use sliders—everything stays in sync.</p>

  <!-- SALES & VSC PENETRATION -->
  <div class="section">
    <h2>Vehicle Sales & VSC Penetration</h2>

    <div class="row">
      <label>Monthly New Vehicle Sales</label>
      <input type="range" id="newSales" min="0" max="1000" step="1" value="80" oninput="sync('newSales'); updateFromPenVSC();">
      <input type="number" id="newSalesNum" min="0" step="1" value="80" oninput="syncBack('newSales'); updateFromPenVSC();">
    </div>

    <div class="row">
      <label>New VSC Penetration %</label>
      <input type="range" id="newPen" min="0" max="100" step="0.1" value="30" oninput="sync('newPen'); updateFromPenVSC();">
      <input type="number" id="newPenNum" min="0" max="100" step="0.1" value="30" oninput="syncBack('newPen'); updateFromPenVSC();">
    </div>

    <div class="row">
      <label>Monthly Used Vehicle Sales</label>
      <input type="range" id="usedSales" min="0" max="1000" step="1" value="60" oninput="sync('usedSales'); updateFromPenVSC();">
      <input type="number" id="usedSalesNum" min="0" step="1" value="60" oninput="syncBack('usedSales'); updateFromPenVSC();">
    </div>

    <div class="row">
      <label>Used VSC Penetration %</label>
      <input type="range" id="usedPen" min="0" max="100" step="0.1" value="25" oninput="sync('usedPen'); updateFromPenVSC();">
      <input type="number" id="usedPenNum" min="0" max="100" step="0.1" value="25" oninput="syncBack('usedPen'); updateFromPenVSC();">
    </div>

    <div class="row">
      <label>Total Monthly Vehicle Sales</label>
      <div style="display:flex; gap:8px;">
        <input type="text" id="totalSalesOut" value="140" readonly>
        <button class="no-print" type="button" onclick="updateFromPenVSC()">Set VSC Volumes from Pen%</button>
      </div>
      <span></span>
    </div>
    <p class="muted">VSC volumes (New/Used) = round(Sales × Pen%).</p>
  </div>

  <!-- VSC VOLUMES & OVER-REMIT -->
  <div class="section">
    <h2>VSC Inputs</h2>

    <div class="row">
      <label>VSC Monthly Contract Volume — New</label>
      <input type="range" id="newContracts" min="0" max="1000" step="1" value="24" oninput="sync('newContracts'); calculate();">
      <input type="number" id="newContractsNum" min="0" step="1" value="24" oninput="syncBack('newContracts'); calculate();">
    </div>

    <div class="row">
      <label><strong>New over-remit</strong> ($ per contract on <strong>100% over-remit</strong>)</label>
      <input type="range" id="newOverRemit" min="0" max="2000" step="10" value="200" oninput="sync('newOverRemit'); calculate();">
      <input type="number" id="newOverRemitNum" min="0" step="1" value="200" oninput="syncBack('newOverRemit'); calculate();">
    </div>

    <div class="row">
      <label>VSC Monthly Contract Volume — Used</label>
      <input type="range" id="usedContracts" min="0" max="1000" step="1" value="15" oninput="sync('usedContracts'); calculate();">
      <input type="number" id="usedContractsNum" min="0" step="1" value="15" oninput="syncBack('usedContracts'); calculate();">
    </div>

    <div class="row">
      <label>Over-remit per contract — Used</label>
      <input type="range" id="usedOverRemit" min="0" max="2000" step="10" value="150" oninput="sync('usedOverRemit'); calculate();">
      <input type="number" id="usedOverRemitNum" min="0" step="1" value="150" oninput="syncBack('usedOverRemit'); calculate();">
    </div>
  </div>

  <!-- TERM / OPEN BALANCE -->
  <div class="section">
    <h2>Advance Term & Open Balance</h2>

    <div class="row">
      <label>Advance Term (months)</label>
      <input type="range" id="term" min="1" max="60" step="1" value="24" oninput="sync('term'); calculate();">
      <input type="number" id="termNum" min="1" max="60" step="1" value="24" oninput="syncBack('term'); calculate();">
    </div>

    <div class="row">
      <label>Current Open Advance Balance ($)</label>
      <input type="range" id="openBal" min="0" max="5000000" step="1000" value="0" oninput="sync('openBal'); calculate();">
      <input type="number" id="openBalNum" min="0" step="1" value="0" oninput="syncBack('openBal'); calculate();">
    </div>

    <div class="hr"></div>
    <div class="muted">
      Fee schedule: 0–17 mo = 0% | 18–23 = 1.5% | 24–29 = 2.0% | 30–35 = 2.5% | 36+ = 3.0%
    </div>
  </div>

  <!-- RESULTS -->
  <div class="section outputs">
    <h2>Results & Breakdown</h2>
    <div class="two">
      <div>
        <p>VSC Advance — New: $<span id="advNew">0</span></p>
        <p>VSC Advance — Used: $<span id="advUsed">0</span></p>
      </div>
      <div>
        <p><strong>Gross Advance</strong>: $<span id="grossAll">0</span></p>
        <p>Advance Fee %: <span id="feePct">0%</span></p>
        <p>Advance Fee $: $<span id="feeAmt">0</span></p>
        <p><strong>Net After Fee</strong>: $<span id="netAfterFee">0</span></p>
        <p>Less: Open Advance Balance: $<span id="openBalOut">0</span></p>
        <p><strong>Final Net to Dealer</strong>: $<span id="finalNet">0</span></p>
      </div>
    </div>
  </div>

  <!-- FIXED TERMS TABLE (always visible) -->
  <div class="section">
    <h2>Quick View — Fixed Terms</h2>
    <p class="muted">Uses your current VSC volumes and $/contract, regardless of the selected term above.</p>
    <table>
      <thead>
        <tr>
          <th>Term (mo)</th>
          <th>Gross Advance</th>
          <th>Fee %</th>
          <th>Fee $</th>
          <th>Net After Fee</th>
          <th>Final Net (less Open Bal)</th>
        </tr>
      </thead>
      <tbody id="fixedTermsBody"></tbody>
    </table>
  </div>

  <div class="powered">Powered by Paulo</div>

<script>
/* ---------- helpers ---------- */
function val(id){ return parseFloat(document.getElementById(id).value) || 0; }
function setVal(id, v){ document.getElementById(id).value = v; }
function sync(id){ setVal(id + 'Num', document.getElementById(id).value); }
/* When typing in number fields, keep the slider capped visually,
   but allow manual overrides to drive calculations via eff(). */
function syncBack(id){
  const numEl = document.getElementById(id + 'Num');
  const rangeEl = document.getElementById(id);
  if (!numEl || !rangeEl) return;
  const typed = parseFloat(numEl.value) || 0;
  const max = rangeEl.max ? parseFloat(rangeEl.max) : Infinity;
  rangeEl.value = Math.min(typed, isFinite(max) ? max : typed);
}

/* Use the larger of slider vs number field so manual entries can exceed slider caps */
function eff(id){
  const rEl = document.getElementById(id);
  const nEl = document.getElementById(id + 'Num');
  const r = rEl ? (parseFloat(rEl.value) || 0) : 0;
  const n = nEl ? (parseFloat(nEl.value) || 0) : r;
  return Math.max(r, n);
}

function feePct(term){
  if (term >= 36) return 3.0;
  if (term >= 30) return 2.5;
  if (term >= 24) return 2.0;
  if (term >= 18) return 1.5;
  return 0.0;
}

function updateTotalsSales() {
  const total = eff('newSales') + eff('usedSales');
  setVal('totalSalesOut', total);
  return total;
}

function updateFromPenVSC() {
  updateTotalsSales();
  const newContracts = Math.round(eff('newSales') * eff('newPen') / 100);
  const usedContracts = Math.round(eff('usedSales') * eff('usedPen') / 100);
  setVal('newContracts', newContracts); setVal('newContractsNum', newContracts);
  setVal('usedContracts', usedContracts); setVal('usedContractsNum', usedContracts);
  calculate();
}

/* ---------- core math ---------- */
function computeForTerm(term, openBalance, monthlyNew, monthlyUsed) {
  const gross = term * (monthlyNew + monthlyUsed);
  const pct = feePct(term);
  const fee = gross * (pct / 100);
  const netAfterFee = gross - fee;
  const finalNet = Math.max(0, netAfterFee - openBalance);
  return { gross, pct, fee, netAfterFee, finalNet };
}

function updateFixedTermTable() {
  const openBalance = eff('openBal');
  const monthlyNew = eff('newContracts') * eff('newOverRemit');
  const monthlyUsed = eff('usedContracts') * eff('usedOverRemit');

  const terms = [12, 18, 24, 20, 26]; // Always show these, by request
  const tbody = document.getElementById('fixedTermsBody');
  tbody.innerHTML = '';

  terms.forEach(t => {
    const { gross, pct, fee, netAfterFee, finalNet } = computeForTerm(t, openBalance, monthlyNew, monthlyUsed);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${t}</td>
      <td>$${gross.toLocaleString(undefined,{maximumFractionDigits:0})}</td>
      <td>${pct}%</td>
      <td>$${fee.toLocaleString(undefined,{maximumFractionDigits:0})}</td>
      <td>$${netAfterFee.toLocaleString(undefined,{maximumFractionDigits:0})}</td>
      <td>$${finalNet.toLocaleString(undefined,{maximumFractionDigits:0})}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* ---------- calculate + update UI ---------- */
function calculate() {
  const term = eff('term');
  const openBalance = eff('openBal');

  const monthlyNew = eff('newContracts') * eff('newOverRemit');
  const monthlyUsed = eff('usedContracts') * eff('usedOverRemit');

  const advNew = term * monthlyNew;
  const advUsed = term * monthlyUsed;
  const grossAll = advNew + advUsed;

  const pct = feePct(term);
  const fee = grossAll * (pct / 100);
  const netAfterFee = grossAll - fee;
  const finalNet = Math.max(0, netAfterFee - openBalance);

  document.getElementById('advNew').textContent = advNew.toLocaleString(undefined,{maximumFractionDigits:0});
  document.getElementById('advUsed').textContent = advUsed.toLocaleString(undefined,{maximumFractionDigits:0});
  document.getElementById('grossAll').textContent = grossAll.toLocaleString(undefined,{maximumFractionDigits:0});
  document.getElementById('feePct').textContent = pct + '%';
  document.getElementById('feeAmt').textContent = fee.toLocaleString(undefined,{maximumFractionDigits:0});
  document.getElementById('netAfterFee').textContent = netAfterFee.toLocaleString(undefined,{maximumFractionDigits:0});
  document.getElementById('openBalOut').textContent = openBalance.toLocaleString(undefined,{maximumFractionDigits:0});
  document.getElementById('finalNet').textContent = finalNet.toLocaleString(undefined,{maximumFractionDigits:0});

  updateFixedTermTable();
}

/* ---------- init ---------- */
updateTotalsSales();
updateFromPenVSC();
calculate();
</script>

</body>
</html>
